<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido al Sistema de Votación</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .container {
            max-width: 600px;
        }
    </style>
</head>
<body>
    <div class="container text-center mt-5">

        <!-- Sección para mostrar mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if user %}
            <!-- Contenido para usuarios con sesión iniciada -->
            <h1 class="mb-3">¡Bienvenido(a) de nuevo, {{ user.get('custom:Nombre', 'Usuario') }}!</h1>

            <!-- Lógica de votación mejorada -->
            {% if has_no_units %}
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-heading">No tienes unidades asignadas</h4>
                    <p>Actualmente no tienes ninguna propiedad o unidad asociada a tu cuenta para poder votar.</p>
                    <hr>
                    <p class="mb-0">Si crees que esto es un error, por favor, contacta a la administración.</p>
                </div>
            {% elif user_has_voted %}
                <div class="alert alert-success" role="alert">
                    <h4 class="alert-heading">¡Gracias por participar!</h4>
                    <p>Ya has completado tu votación para todas tus unidades.</p>
                    {% if voted_units %}
                        <hr>
                        <p class="mb-2 font-weight-bold text-left">Votos registrados para:</p>
                        <ul class="list-group text-left">
                            {% for unit in voted_units %}
                                <li class="list-group-item">
                                    {{ unit.tipo_unidad }} {{ unit.unidad }}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% else %}
                <p class="lead mb-4">Tu participación es importante. Haz clic en el botón para registrar tu voto.</p>
                <a href="{{ url_for('form') }}" class="btn btn-success btn-lg">Ir a Votar</a>
            {% endif %}
            <!-- Fin de la lógica de votación -->

            <hr class="my-4">
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-secondary">Cerrar Sesión</a>
        
        {% else %}
            <!-- Contenido para usuarios sin sesión (público) -->
            <h1 class="mb-3">Bienvenido al Sistema de Votación</h1>
            <p class="lead mb-4">Para participar en la encuesta, por favor, inicia sesión con tus credenciales.</p>
            <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg">Iniciar Sesión</a>
        
        {% endif %}

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
